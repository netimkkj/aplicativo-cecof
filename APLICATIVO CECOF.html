<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerenciador de Processos - CECOF</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #494949;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 900px;
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .hidden {
      display: none;
    }
    h1 {
      color: #333;
      font-size: 24px;
      margin-bottom: 20px;
    }
    button {
      padding: 12px 20px;
      background-color: #007BFF;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 10px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    .form-group {
      margin-bottom: 15px;
      text-align: left;
    }
    .form-group label {
      font-size: 16px;
      color: #333;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-top: 8px;
      box-sizing: border-box;
    }
    .process-list {
      margin-top: 30px;
      text-align: left;
      max-height: 350px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      justify-content: flex-start;
    }
    .process-item {
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease;
      text-align: left;
      position: relative;
    }
    .process-item:hover {
      transform: scale(1.02);
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab {
      padding: 12px;
      cursor: pointer;
      background-color: #f4f4f4;
      border: 1px solid #ddd;
      margin: 0 5px;
      border-radius: 5px;
    }
    .tab.active {
      background-color: #007BFF;
      color: white;
    }
    .confirmation-popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .confirmation-box {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      width: 100%;
    }
    .confirmation-box button {
      margin-top: 10px;
      background-color: #dc3545;
      color: white;
    }
    .confirmation-box button:hover {
      background-color: #c82333;
    }
    .anotacoes-container {
      margin-top: 10px;
      transition: all 0.3s ease;
      padding: 15px;
      background-color: #f1f1f1;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      opacity: 0;
      visibility: hidden;
      max-height: 0;
      overflow: hidden;
    }
    .anotacoes-container.active {
      opacity: 1;
      visibility: visible;
      max-height: 400px;
    }
    .anotacoes-container textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      resize: none;
    }
    .anotacoes-container button {
      margin-top: 10px;
      background-color: #28a745;
      color: white;
    }
    .anotacoes-container button:hover {
      background-color: #218838;
    }
    .aba {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .aba.active {
      display: block;
    }
    @keyframes fadeIn {
      0% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }
    /* Cores para os status */
    .em-andamento {
      background-color: #f1f1f1;
    }
    .suspenso {
      background-color: #ffec99;
    }
    .concluido {
      background-color: #d4edda;
    }
    /* Estilo dos botões de status */
    .status-buttons {
      display: none;
      justify-content: space-around;
      margin-top: 10px;
    }
    .status-buttons.active {
      display: flex;
    }
    .status-buttons button {
      background-color: #f4f4f4;
      color: #333;
      padding: 10px 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .status-buttons button:hover {
      background-color: #007BFF;
      color: white;
    }
  </style>
</head>
<body>

  <div id="welcomeScreen" class="container">
    <h1>Bem-vindo ao Gerenciador de Processos - CECOF</h1>
    <button onclick="irParaTelaPrincipal()">Entrar</button>
  </div>

  <div id="mainScreen" class="container hidden">
    <h1>Controle de Processos - CECOF</h1>
    <button onclick="voltarParaInicio()">Voltar</button>
    <div class="tabs">
      <div class="tab active" onclick="mostrarAba('adicionar')">Adicionar Processo</div>
      <div class="tab" onclick="mostrarAba('listar')">Processos</div>
    </div>
    <div id="adicionar" class="aba active">
      <h2>Adicionar Novo Processo</h2>
      <div class="form-group">
        <label for="descricao">Número do Processo</label>
        <input type="text" id="descricao" placeholder="N° do processo" />
        <div class="error" id="descricaoError"></div>
      </div>
      <div class="form-group">
        <button onclick="adicionarProcesso()">Adicionar Processo</button>
      </div>
    </div>
    <div id="listar" class="aba hidden">
      <h2>Lista de Processos</h2>
      <div class="form-group">
        <label for="search">Pesquisar pelo número do processo</label>
        <input
          type="text"
          id="search"
          placeholder="Digite o número do processo"
          onkeyup="pesquisarProcesso()"
        />
      </div>
      <div class="process-list" id="processList"></div>
    </div>
  </div>

  <!-- Pop-up de Confirmação para Excluir -->
  <div id="confirmationPopup" class="confirmation-popup">
    <div class="confirmation-box">
      <h3>Você tem certeza que deseja excluir este processo?</h3>
      <button onclick="confirmarExclusao()">Sim, excluir</button>
      <button onclick="fecharPopup()">Cancelar</button>
    </div>
  </div>

  <script>
    let processoParaExcluir = null;

    function irParaTelaPrincipal() {
      document.getElementById("welcomeScreen").classList.add("hidden");
      document.getElementById("mainScreen").classList.remove("hidden");
      listarProcessos();
    }

    function voltarParaInicio() {
      document.getElementById("mainScreen").classList.add("hidden");
      document.getElementById("welcomeScreen").classList.remove("hidden");
    }

    function mostrarAba(aba) {
      document.querySelectorAll('.aba').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById(aba).classList.add('active');
      document.querySelector(`[onclick="mostrarAba('${aba}')"]`).classList.add('active');
      if (aba === 'listar') listarProcessos();
    }

    function adicionarProcesso() {
      const descricao = document.getElementById("descricao").value.trim();
      if (descricao.length < 10 || descricao.length > 20) {
        document.getElementById("descricaoError").textContent =
          "O número do processo deve ter entre 10 e 20 caracteres.";
        return;
      } else {
        document.getElementById("descricaoError").textContent = "";
      }
      const processos = JSON.parse(localStorage.getItem("processos")) || [];
      if (processos.some(p => p.numeroProcesso === descricao)) {
        document.getElementById("descricaoError").textContent =
          "Já existe um processo com esse número.";
        return;
      }
      processos.push({ numeroProcesso: descricao, status: "Em andamento", anotacoes: "" });
      localStorage.setItem("processos", JSON.stringify(processos));
      document.getElementById("descricao").value = "";
      mostrarAba('listar');
    }

    function listarProcessos() {
      const processos = JSON.parse(localStorage.getItem("processos")) || [];
      const processListDiv = document.getElementById("processList");
      processListDiv.innerHTML = "";
      if (processos.length === 0) {
        processListDiv.innerHTML = "<p>Nenhum processo encontrado.</p>";
        return;
      }
      processos.forEach((processo, i) => {
        const processItem = document.createElement("div");
        processItem.classList.add("process-item");
        let statusClass = "em-andamento";
        if (processo.status === "Suspenso") statusClass = "suspenso";
        if (processo.status === "Concluído") statusClass = "concluido";
        processItem.classList.add(statusClass);
        processItem.innerHTML = `
          <div><strong>N° Processo:</strong> ${processo.numeroProcesso}</div>
          <div><strong>Status:</strong> ${processo.status}</div>
          <button onclick="toggleAnotacoes(${i})">Exibir/Ocultar Anotações</button>
          <div class="anotacoes-container" id="anotacoes-${i}">
            <textarea id="input-anotacoes-${i}" placeholder="Adicione observações">${processo.anotacoes}</textarea>
            <button onclick="salvarAnotacoes(${i})">Salvar Anotações</button>
          </div>
          <button onclick="confirmarExclusaoProcesso(${i})">Excluir</button>
          <button onclick="toggleStatusButtons(${i})">Selecionar Status</button>
          <div class="status-buttons" id="status-buttons-${i}">
            <button onclick="alterarStatus(${i}, 'Em andamento')">Em andamento</button>
            <button onclick="alterarStatus(${i}, 'Suspenso')">Suspenso</button>
            <button onclick="alterarStatus(${i}, 'Concluído')">Concluído</button>
          </div>
        `;
        processListDiv.appendChild(processItem);
      });
    }

    function toggleAnotacoes(i) {
      const container = document.getElementById(`anotacoes-${i}`);
      container.classList.toggle("active");
    }

    function salvarAnotacoes(i) {
      const text = document.getElementById(`input-anotacoes-${i}`).value;
      const processos = JSON.parse(localStorage.getItem("processos"));
      processos[i].anotacoes = text;
      localStorage.setItem("processos", JSON.stringify(processos));
    }

    function confirmarExclusaoProcesso(i) {
      processoParaExcluir = i;
      document.getElementById("confirmationPopup").style.display = "flex";
    }

    function confirmarExclusao() {
      const processos = JSON.parse(localStorage.getItem("processos"));
      processos.splice(processoParaExcluir, 1);
      localStorage.setItem("processos", JSON.stringify(processos));
      listarProcessos();
      fecharPopup();
    }

    function fecharPopup() {
      document.getElementById("confirmationPopup").style.display = "none";
    }

    function alterarStatus(i, status) {
      const processos = JSON.parse(localStorage.getItem("processos"));
      processos[i].status = status;
      localStorage.setItem("processos", JSON.stringify(processos));
      listarProcessos();
    }

    function toggleStatusButtons(i) {
      const btns = document.getElementById(`status-buttons-${i}`);
      btns.classList.toggle("active");
    }

    // A função de pesquisa agora mapeia o índice original para cada processo filtrado.
    function pesquisarProcesso() {
      const searchValue = document.getElementById("search").value.toLowerCase();
      const processos = JSON.parse(localStorage.getItem("processos")) || [];
      // Cria um array com {processo, originalIndex}
      const filtrados = [];
      processos.forEach((p, idx) => {
        if (p.numeroProcesso.toLowerCase().includes(searchValue)) {
          filtrados.push({ processo: p, originalIndex: idx });
        }
      });
      const processListDiv = document.getElementById("processList");
      processListDiv.innerHTML = "";
      if (filtrados.length === 0) {
        processListDiv.innerHTML = "<p>Nenhum processo encontrado.</p>";
        return;
      }
      filtrados.forEach(item => {
        const i = item.originalIndex;
        const processo = item.processo;
        const processItem = document.createElement("div");
        processItem.classList.add("process-item");
        let statusClass = "em-andamento";
        if (processo.status === "Suspenso") statusClass = "suspenso";
        if (processo.status === "Concluído") statusClass = "concluido";
        processItem.classList.add(statusClass);
        processItem.innerHTML = `
          <div><strong>N° Processo:</strong> ${processo.numeroProcesso}</div>
          <div><strong>Status:</strong> ${processo.status}</div>
          <button onclick="toggleAnotacoes(${i})">Exibir/Ocultar Anotações</button>
          <div class="anotacoes-container" id="anotacoes-${i}">
            <textarea id="input-anotacoes-${i}" placeholder="Adicione observações">${processo.anotacoes}</textarea>
            <button onclick="salvarAnotacoes(${i})">Salvar Anotações</button>
          </div>
          <button onclick="confirmarExclusaoProcesso(${i})">Excluir</button>
          <button onclick="toggleStatusButtons(${i})">Selecionar Status</button>
          <div class="status-buttons" id="status-buttons-${i}">
            <button onclick="alterarStatus(${i}, 'Em andamento')">Em andamento</button>
            <button onclick="alterarStatus(${i}, 'Suspenso')">Suspenso</button>
            <button onclick="alterarStatus(${i}, 'Concluído')">Concluído</button>
          </div>
        `;
        processListDiv.appendChild(processItem);
      });
    }

    window.onload = listarProcessos;
  </script>

</body>
</html>
